<% approved_reviews = product.approved_reviews %>
<div class="reviews-section-advanced" data-controller="reviews-filter reviews-tabs">
  <%# Summary Section with Rating and Images %>
  <div class="mb-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
    <%# Left: Rating Summary %>
    <div class="lg:col-span-2">
      <div class="flex items-start gap-8 mb-6">
        <div class="flex-shrink-0">
          <div class="text-5xl font-bold text-gray-900 mb-2">
            <%= number_with_precision(product.average_rating, precision: 1) %>/5
          </div>
          <div class="flex items-center gap-1 mb-2">
            <% 5.times do |i| %>
              <% if i < product.average_rating.floor %>
                <span class="text-black text-2xl leading-none">★</span>
              <% elsif i < product.average_rating.ceil && product.average_rating % 1 >= 0.5 %>
                <span class="text-black text-2xl leading-none">★</span>
              <% else %>
                <span class="text-gray-300 text-2xl leading-none">☆</span>
              <% end %>
            <% end %>
          </div>
          <div class="text-sm text-gray-600">
            <%= product.reviews_count %> <%= Spree.t('storefront.reviews.ratings', default: 'ratings') %>
          </div>
        </div>
        
        <%# Rating Distribution Bars %>
        <div class="flex-1 space-y-2">
          <% 5.downto(1) do |rating| %>
            <% count = approved_reviews.where(rating: rating).count %>
            <% percentage = product.reviews_count > 0 ? (count.to_f / product.reviews_count * 100) : 0 %>
            <div class="flex items-center gap-3">
              <span class="text-sm text-gray-700 w-8"><%= rating %> ★</span>
              <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
                <div class="h-full bg-gray-900 rounded-full transition-all duration-500" style="width: <%= percentage %>%"></div>
              </div>
              <span class="text-sm text-gray-600 w-12 text-right"><%= percentage.round %>%</span>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    
    <%# Right: Product Images Grid %>
    <div class="lg:col-span-1">
      <% if defined?(product) && product.respond_to?(:images) %>
        <% images = product.images.limit(12) %>
        <% if images.any? %>
          <div class="grid grid-cols-3 gap-2">
            <% images.each do |image| %>
              <div class="aspect-square overflow-hidden rounded-lg">
                <%= spree_image_tag(image, width: 150, height: 150, alt: image_alt(image), class: 'w-full h-full object-cover') %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>

  <%# Tabs and Action Buttons %>
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-gray-200 pb-4">
    <div class="flex items-center gap-6">
      <button type="button" 
              data-reviews-tabs-target="tab"
              data-action="click->reviews-tabs#switchTab"
              data-tab="reviews"
              class="tab-button active text-base font-semibold text-gray-900 border-b-2 border-gray-900 pb-2">
        <%= Spree.t('storefront.reviews.title', default: 'Değerlendirmeler') %> <%= product.reviews_count %>
      </button>
      <button type="button" 
              data-reviews-tabs-target="tab"
              data-action="click->reviews-tabs#switchTab"
              data-tab="questions"
              class="tab-button text-base font-medium text-gray-600 hover:text-gray-900 pb-2">
        <%= Spree.t('storefront.reviews.questions', default: 'Sorular') %> 0
      </button>
    </div>
    <div class="flex items-center gap-3">
      <button type="button" 
              data-action="click->reviews-tabs#showReviewForm"
              class="spree-button-primary">
        <%= Spree.t('storefront.reviews.write_review', default: 'Yorum Yaz') %>
      </button>
      <a href="https://wa.me/905300632441?text=<%= URI.encode_www_form_component("Merhaba, #{product.name} ürünü hakkında soru sormak istiyorum.") %>" 
         target="_blank"
         rel="noopener noreferrer"
         class="spree-button-whatsapp">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
        </svg>
        <%= Spree.t('storefront.reviews.ask_question', default: 'Soru Sor') %>
      </a>
    </div>
  </div>

  <%# Filtering and Sorting Section %>
  <div class="mb-6 space-y-4">
    <div class="flex items-center justify-between flex-wrap gap-4">
      <div class="text-sm text-gray-600">
        <span data-reviews-filter-target="reviewCount">1-<%= [approved_reviews.count, 5].min %></span> / <%= product.reviews_count %> <%= Spree.t('storefront.reviews.reviews', default: 'Değerlendirme') %>
      </div>
    </div>
    
    <div class="flex flex-col lg:flex-row lg:items-center gap-4">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="text-sm text-gray-700 font-medium"><%= Spree.t('storefront.reviews.filter_by', default: 'Değerlendirme önemine göre filtrele:') %></span>
        <select 
          data-reviews-filter-target="ratingSort"
          data-action="change->reviews-filter#filter"
          class="filter-chip px-4 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-900 hover:bg-gray-200 transition-colors border-0 cursor-pointer">
          <option value="all"><%= Spree.t('storefront.reviews.all_ratings', default: 'Tüm Puanlar') %></option>
          <option value="best"><%= Spree.t('storefront.reviews.best_ratings', default: 'En İyiler') %></option>
          <option value="worst"><%= Spree.t('storefront.reviews.worst_ratings', default: 'En Olumsuzlar') %></option>
        </select>
      </div>
      
      <div class="flex items-center gap-4 flex-1 lg:justify-end">
        <div class="relative flex-1 lg:max-w-xs">
          <label class="text-sm text-gray-700 font-medium mr-2"><%= Spree.t('storefront.reviews.search', default: 'Search:') %></label>
          <input 
            type="text" 
            placeholder="Keyword" 
            data-reviews-filter-target="search"
            data-action="input->reviews-filter#filter"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
          <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </div>
        <div class="flex items-center gap-2">
          <label class="text-sm text-gray-700 font-medium"><%= Spree.t('storefront.reviews.sort_by', default: 'Sırala:') %></label>
          <select 
            data-reviews-filter-target="sortFilter"
            data-action="change->reviews-filter#filter"
            class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white">
            <option value="recent"><%= Spree.t('storefront.reviews.most_recent', default: 'En Yeni') %></option>
            <option value="relevant"><%= Spree.t('storefront.reviews.most_relevant', default: 'En İlgili') %></option>
            <option value="helpful"><%= Spree.t('storefront.reviews.most_helpful', default: 'En Yararlı') %></option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <%# Questions Tab Content %>
  <div data-reviews-tabs-target="content" data-tab="questions" class="hidden">
    <div class="text-center py-12 bg-gray-50 rounded-lg border border-gray-200">
      <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <p class="text-gray-600 text-lg mb-4"><%= Spree.t('storefront.reviews.no_questions', default: 'Henüz soru sorulmamış') %></p>
      <a href="https://wa.me/905300632441?text=<%= URI.encode_www_form_component("Merhaba, #{product.name} ürünü hakkında soru sormak istiyorum.") %>" 
         target="_blank"
         rel="noopener noreferrer"
         class="spree-button-whatsapp">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
        </svg>
        <%= Spree.t('storefront.reviews.ask_on_whatsapp', default: 'WhatsApp ile Sor') %>
      </a>
    </div>
  </div>

  <%# Reviews List - 3 Column Layout %>
  <div data-reviews-tabs-target="content" data-tab="reviews">
  <% if approved_reviews.any? %>
    <div class="space-y-6 mb-8" data-reviews-filter-target="reviewsContainer">
      <% approved_reviews.each do |review| %>
        <div class="review-card-advanced bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow duration-200" 
             data-rating="<%= review.rating %>"
             data-review-text="<%= review.review.downcase %> <%= review.title.downcase %>">
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <%# Left Column: Reviewer Info %>
            <div class="lg:col-span-3">
              <div class="space-y-3">
                <div>
                  <div class="font-semibold text-gray-900 mb-1"><%= review.user.full_name || review.user.email.split('@').first %></div>
                  <div class="flex items-center gap-1.5 mb-2">
                    <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-xs text-green-600 font-medium">Verified Buyer</span>
                  </div>
                  <div class="flex items-center gap-1.5 mb-4">
                    <input type="checkbox" checked disabled class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                    <span class="text-xs text-gray-600"><%= Spree.t('storefront.reviews.recommends', default: 'Bu ürünü öneriyor') %></span>
                  </div>
                </div>
                
                <div class="space-y-2 text-sm">
                  <% if review.usage_type.present? %>
                    <div class="flex justify-between">
                      <span class="text-gray-600"><%= Spree.t('storefront.reviews.usage_type', default: 'Kullanım Tipi') %>:</span>
                      <span class="text-gray-900 font-medium"><%= Spree.t("storefront.reviews.usage_type_#{review.usage_type}", default: review.usage_type.humanize) %></span>
                    </div>
                  <% end %>
                  <% if review.experience_level.present? %>
                    <div class="flex justify-between">
                      <span class="text-gray-600"><%= Spree.t('storefront.reviews.experience_level', default: 'Deneyim Seviyesi') %>:</span>
                      <span class="text-gray-900 font-medium"><%= Spree.t("storefront.reviews.experience_level_#{review.experience_level}", default: review.experience_level.humanize) %></span>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
            
            <%# Middle Column: Review Content %>
            <div class="lg:col-span-6">
              <div class="space-y-4">
                <%# Rating Stars %>
                <div class="flex items-center gap-1">
                  <% review.rating.times do %>
                    <span class="text-black text-lg leading-none">★</span>
                  <% end %>
                  <% (5 - review.rating).times do %>
                    <span class="text-gray-300 text-lg leading-none">☆</span>
                  <% end %>
                </div>
                
                <%# Review Title %>
                <% if review.title.present? %>
                  <h3 class="font-semibold text-lg text-gray-900"><%= review.title %></h3>
                <% end %>
                
                <%# Review Text %>
                <p class="text-gray-700 text-sm leading-relaxed"><%= review.review %></p>
                
                <%# Sliders: Fit, Comfort, Performance %>
                <div class="space-y-3 pt-2">
                  <div>
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                      <span><%= Spree.t('storefront.reviews.runs_small', default: 'Runs Small') %></span>
                      <span class="font-medium"><%= Spree.t('storefront.reviews.fit', default: 'Fit') %></span>
                      <span><%= Spree.t('storefront.reviews.runs_large', default: 'Runs Large') %></span>
                    </div>
                    <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div class="h-full bg-gray-900 rounded-full" style="width: 60%"></div>
                    </div>
                  </div>
                  
                  <div>
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                      <span><%= Spree.t('storefront.reviews.min', default: 'Min.') %></span>
                      <span class="font-medium"><%= Spree.t('storefront.reviews.comfort', default: 'Comfort') %></span>
                      <span><%= Spree.t('storefront.reviews.max', default: 'Max.') %></span>
                    </div>
                    <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div class="h-full bg-gray-900 rounded-full" style="width: 100%"></div>
                    </div>
                  </div>
                  
                  <div>
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                      <span><%= Spree.t('storefront.reviews.min', default: 'Min.') %></span>
                      <span class="font-medium"><%= Spree.t('storefront.reviews.performance', default: 'Performance') %></span>
                      <span><%= Spree.t('storefront.reviews.max', default: 'Max.') %></span>
                    </div>
                    <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div class="h-full bg-gray-900 rounded-full" style="width: 100%"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <%# Right Column: Photo and Helpfulness %>
            <div class="lg:col-span-3">
              <div class="space-y-4">
                <%# User Photo Placeholder %>
                <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                  <div class="w-full h-full flex items-center justify-center text-gray-400">
                    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                  </div>
                </div>
                
                <div class="text-xs text-gray-500">
                  <%= time_ago_in_words(review.created_at) %> <%= Spree.t('storefront.reviews.ago', default: 'önce') %>
                </div>
                
                <div>
                  <p class="text-xs text-gray-600 mb-2"><%= Spree.t('storefront.reviews.was_helpful', default: 'Bu yorum yararlı mıydı?') %></p>
                  <div class="flex items-center gap-3">
                    <button type="button" class="flex items-center gap-1 text-gray-600 hover:text-orange-500 transition-colors group" data-action="click->reviews-filter#helpful">
                      <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                      </svg>
                      <span class="text-xs font-medium">0</span>
                    </button>
                    <button type="button" class="flex items-center gap-1 text-gray-600 hover:text-red-500 transition-colors group" data-action="click->reviews-filter#notHelpful">
                      <svg class="w-4 h-4 group-hover:scale-110 transition-transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                      </svg>
                      <span class="text-xs font-medium">0</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12 bg-gray-50 rounded-lg border border-gray-200">
      <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
      </svg>
      <p class="text-gray-600 text-lg mb-2"><%= Spree.t('storefront.reviews.no_reviews', default: 'Henüz değerlendirme yok') %></p>
      <p class="text-gray-500 text-sm"><%= Spree.t('storefront.reviews.be_first', default: 'İlk değerlendirmeyi siz yapın!') %></p>
    </div>
  <% end %>
  </div>
  
  <%# Review Form - Hidden by default, shown when "Write A Review" is clicked %>
  <div data-reviews-tabs-target="reviewForm" class="hidden mt-8">
    <% if try_spree_current_user %>
      <% existing_review = product.reviews.find_by(user: spree_current_user) %>
      <% if existing_review %>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
          <div class="flex items-start gap-3">
            <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div>
              <p class="text-blue-900 font-medium mb-1">
                <%= Spree.t('storefront.reviews.already_reviewed', default: 'Bu ürün için zaten bir yorum bıraktınız.') %>
              </p>
              <% unless existing_review.approved? %>
                <p class="text-sm text-blue-700">
                  <%= Spree.t('storefront.reviews.pending_approval', default: 'Yorumunuz onay bekliyor.') %>
                </p>
              <% end %>
            </div>
          </div>
        </div>
      <% else %>
        <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 bg-gray-50">
          <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
            </svg>
            <%= Spree.t('storefront.reviews.write_review', default: 'Yorum Yaz') %>
          </h3>
          <%= form_with url: spree.product_reviews_path(product), method: :post, data: { turbo: false }, local: true, multipart: true, class: "space-y-6" do |f| %>
            <div>
              <label class="block text-sm font-semibold text-gray-900 mb-3">
                <%= Spree.t('storefront.reviews.rating', default: 'Puanınız') %> <span class="text-red-500">*</span>
              </label>
              <div class="flex gap-2" data-controller="rating-picker">
                <% 5.times do |i| %>
                  <%= radio_button_tag 'review[rating]', i + 1, false, 
                      id: "rating_#{i + 1}",
                      class: "hidden rating-input",
                      required: true,
                      data: { action: 'change->rating-picker#update', 'rating-picker-target': 'input' } %>
                  <label for="rating_<%= i + 1 %>" 
                         class="text-4xl cursor-pointer text-gray-300 hover:text-orange-400 transition-all duration-200 hover:scale-110 rating-star"
                         data-rating-picker-target="star"
                         data-rating="<%= i + 1 %>">
                    ★
                  </label>
                <% end %>
              </div>
            </div>
            
            <div>
              <%= label_tag 'review[title]', Spree.t('storefront.reviews.title_label', default: 'Başlık'), class: "block text-sm font-semibold text-gray-900 mb-2" %>
              <%= text_field_tag 'review[title]', nil, required: true, maxlength: 255, 
                  class: "w-full border-2 border-gray-300 rounded-lg px-4 py-3 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors", 
                  placeholder: Spree.t('storefront.reviews.title_placeholder', default: 'Değerlendirmenize bir başlık verin') %>
            </div>
            
            <div>
              <%= label_tag 'review[review]', Spree.t('storefront.reviews.review_label', default: 'Yorumunuz'), class: "block text-sm font-semibold text-gray-900 mb-2" %>
              <%= text_area_tag 'review[review]', nil, required: true, rows: 6,
                  class: "w-full border-2 border-gray-300 rounded-lg px-4 py-3 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors resize-none", 
                  placeholder: Spree.t('storefront.reviews.review_placeholder', default: 'Ürün hakkındaki düşüncelerinizi paylaşın...') %>
            </div>

            <div>
              <%= label_tag 'review[size_fit]', Spree.t('storefront.reviews.size_fit', default: 'Beden Uyumu'), class: "block text-sm font-semibold text-gray-900 mb-2" %>
              <%= select_tag 'review[size_fit]', 
                  options_for_select([
                    [Spree.t('storefront.reviews.size_fit_runs_small', default: 'Küçük Gelir'), 'runs_small'],
                    [Spree.t('storefront.reviews.size_fit_fit', default: 'Uygun'), 'fit'],
                    [Spree.t('storefront.reviews.size_fit_runs_large', default: 'Büyük Gelir'), 'runs_large']
                  ]),
                  { include_blank: Spree.t('storefront.reviews.select_size_fit', default: 'Seçiniz'), class: "w-full border-2 border-gray-300 rounded-lg px-4 py-3 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors" } %>
            </div>

            <div>
              <%= label_tag 'review[usage_type]', Spree.t('storefront.reviews.usage_type', default: 'Kullanım Tipi'), class: "block text-sm font-semibold text-gray-900 mb-2" %>
              <%= select_tag 'review[usage_type]', 
                  options_for_select([
                    [Spree.t('storefront.reviews.usage_type_daily', default: 'Günlük Kullanım'), 'daily'],
                    [Spree.t('storefront.reviews.usage_type_racing', default: 'Yarış'), 'racing'],
                    [Spree.t('storefront.reviews.usage_type_off_road', default: 'Off-Road'), 'off_road'],
                    [Spree.t('storefront.reviews.usage_type_touring', default: 'Touring'), 'touring']
                  ]),
                  { include_blank: Spree.t('storefront.reviews.select_usage_type', default: 'Seçiniz'), class: "w-full border-2 border-gray-300 rounded-lg px-4 py-3 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors" } %>
            </div>

            <div>
              <%= label_tag 'review[experience_level]', Spree.t('storefront.reviews.experience_level', default: 'Deneyim Seviyesi'), class: "block text-sm font-semibold text-gray-900 mb-2" %>
              <%= select_tag 'review[experience_level]', 
                  options_for_select([
                    [Spree.t('storefront.reviews.experience_level_beginner', default: 'Başlangıç'), 'beginner'],
                    [Spree.t('storefront.reviews.experience_level_intermediate', default: 'Orta'), 'intermediate'],
                    [Spree.t('storefront.reviews.experience_level_advanced', default: 'İleri'), 'advanced'],
                    [Spree.t('storefront.reviews.experience_level_expert', default: 'Uzman'), 'expert']
                  ]),
                  { include_blank: Spree.t('storefront.reviews.select_experience_level', default: 'Seçiniz'), class: "w-full border-2 border-gray-300 rounded-lg px-4 py-3 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors" } %>
            </div>

            <div>
              <%= label_tag 'review[images]', Spree.t('storefront.reviews.images', default: 'Resimler (İsteğe Bağlı)'), class: "block text-sm font-semibold text-gray-900 mb-2" %>
              <%= file_field_tag 'review[images][]', 
                  multiple: true, 
                  accept: 'image/*',
                  class: "w-full border-2 border-gray-300 rounded-lg px-4 py-3 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors",
                  data: { direct_upload_url: main_app.rails_direct_uploads_path } %>
              <p class="text-xs text-gray-500 mt-1"><%= Spree.t('storefront.reviews.images_help', default: 'Birden fazla resim seçebilirsiniz') %></p>
            </div>
            
            <div>
              <%= submit_tag Spree.t('storefront.reviews.submit', default: 'Değerlendirmeyi Gönder'), 
                  class: "spree-button-primary px-8 py-3" %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <div class="bg-gradient-to-r from-orange-50 to-orange-100 border-2 border-orange-200 rounded-xl p-8 text-center">
        <svg class="w-16 h-16 text-orange-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
        <p class="text-gray-800 text-lg font-medium mb-2">
          <%= Spree.t('storefront.reviews.login_required', default: 'Değerlendirme yazmak için giriş yapın') %>
        </p>
        <p class="text-gray-600 text-sm mb-6">
          <%= Spree.t('storefront.reviews.login_description', default: 'Ürün hakkındaki görüşlerinizi paylaşmak için hesabınıza giriş yapmanız gerekiyor.') %>
        </p>
        <%= link_to Spree.t('storefront.reviews.login', default: 'Giriş Yap'), spree_login_path, 
            class: "bg-orange-500 hover:bg-orange-600 text-white font-bold px-8 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 inline-block" %>
      </div>
    <% end %>
  </div>
</div>
